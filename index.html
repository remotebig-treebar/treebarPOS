<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS System - Complete Version</title>
    <link rel="stylesheet" href="styles.css">
    
    <!-- External Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/styled-components@5.3.11/dist/styled-components.min.js"></script>
    <script src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
        }
        
        #root {
            width: 100%;
            height: 100vh;
        }
        
        /* Loading spinner */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-size: 18px;
            color: #666;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ce4b4b;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                margin: 0;
                padding: 0;
                background: white;
            }
            
            .receipt-preview-popup {
                width: 80mm;
                margin: 0;
                padding: 0;
                background: white;
                color: #000000;
            }
            
            .receipt-preview-popup table {
                width: 100%;
                border-collapse: collapse;
            }
            
            .receipt-preview-popup th,
            .receipt-preview-popup td {
                padding: 2px 4px;
                text-align: left;
                border: none;
                font-size: inherit;
            }
            
            .receipt-preview-popup .summary-total {
                font-weight: bold;
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div id="root">
        <div class="loading">
            <div class="spinner"></div>
            กำลังโหลดระบบ POS...
        </div>
    </div>
    
    <!-- Main Application Script -->
    <script type="text/babel" src="app_simple.js"></script>
    
    <!-- PromptPay QR Code Generator -->
    <script>
        // Enhanced PromptPay QR Code Generator
        window.generatePromptPayPayload = function(phoneNumber, amount) {
            // Remove any non-digit characters from phone number
            const cleanPhone = phoneNumber.replace(/\D/g, '');
            
            // Convert phone number to proper format
            let formattedPhone;
            if (cleanPhone.startsWith('0')) {
                formattedPhone = '66' + cleanPhone.substring(1);
            } else if (cleanPhone.startsWith('66')) {
                formattedPhone = cleanPhone;
            } else {
                formattedPhone = '66' + cleanPhone;
            }
            
            // Build PromptPay payload
            let payload = '';
            
            // Payload Format Indicator
            payload += '000201';
            
            // Point of Initiation Method
            payload += '010212';
            
            // Merchant Account Information
            payload += '29';
            const phoneLength = formattedPhone.length.toString().padStart(2, '0');
            payload += (phoneLength.length + formattedPhone.length + 4).toString().padStart(2, '0');
            payload += '0016A000000677010111';
            payload += '01' + phoneLength + formattedPhone;
            
            // Transaction Currency (THB = 764)
            payload += '5303764';
            
            // Transaction Amount
            if (amount && amount > 0) {
                const amountStr = amount.toFixed(2);
                payload += '54' + amountStr.length.toString().padStart(2, '0') + amountStr;
            }
            
            // Country Code
            payload += '5802TH';
            
            // CRC placeholder
            payload += '6304';
            
            // Calculate CRC16
            const crc = calculateCRC16(payload);
            payload += crc;
            
            return payload;
        };
        
        // CRC16 calculation for PromptPay
        function calculateCRC16(data) {
            const polynomial = 0x1021;
            let crc = 0xFFFF;
            
            for (let i = 0; i < data.length; i++) {
                crc ^= (data.charCodeAt(i) << 8);
                for (let j = 0; j < 8; j++) {
                    if (crc & 0x8000) {
                        crc = (crc << 1) ^ polynomial;
                    } else {
                        crc <<= 1;
                    }
                    crc &= 0xFFFF;
                }
            }
            
            return crc.toString(16).toUpperCase().padStart(4, '0');
        }
    </script>
</body>
</html>

